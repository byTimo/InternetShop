@using InternetShop.DataLayer.Entities
@using InternetShop.WebUI.Models
@model ProductViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@if (TempData["error-message"] != null)
{
    <div class="alert alert-danger">
        <span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>
        <span class="sr-only"></span>@TempData["error-message"]
    </div>
}
<div class="panel panel-default">
    <div class="panel-heading">
        <h2 class="text-primary">
            <span class="glyphicon glyphicon-edit"></span>&nbsp;
            Товар "@Model.Name"
        </h2>
    </div>
    <div class="panel-body">
        @using (Html.BeginForm("EditProduct", "Admin", FormMethod.Post, new {enctype = "multipart/form-data"}))
        {
            @Html.HiddenFor(m => m.ProductId)
            @Html.HiddenFor(m => m.Type)
            <div class="form-group">
                @Html.LabelFor(m => m.Name, new {@class = "control-label"})
                @Html.TextBoxFor(m => m.Name, new {@class = "form-control"})
                @Html.ValidationMessageFor(m => m.Name)
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Price, new {@class = "control-label"})
                @Html.TextBoxFor(m => m.Price, new {@class = "form-control"})
                @Html.ValidationMessageFor(m => m.Price)
            </div>
            <div class="form-group">
                @Html.LabelFor(m => m.Year, new {@class = "control-label"})
                @Html.TextBoxFor(m => m.Year, new {@class = "form-control"})
            </div>
            if (Model.Type == ProductType.Audio)
            {
                <div class="form-group">
                    @Html.LabelFor(m => m.Perfomer, new {@class = "control-label"})
                    @Html.TextBoxFor(m => m.Perfomer, new {@class = "form-control"})
                </div>
                <div class="form-group">
                    @Html.LabelFor(m => m.MusicalDirection, new {@class = "control-label"})
                    @Html.TextBoxFor(m => m.MusicalDirection, new {@class = "form-control"})
                </div>
            }
            else
            {
                <div class="form-group">
                    @Html.LabelFor(m => m.Director, new {@class = "control-label"})
                    @Html.TextBoxFor(m => m.Director, new {@class = "form-control"})
                </div>
                <div class="form-group">
                    @Html.LabelFor(m => m.Genre, new {@class = "control-label"})
                    @Html.TextBoxFor(m => m.Genre, new {@class = "form-control"})
                </div>

            }
            <div class="form-group">
                @Html.LabelFor(m => m.Description, new {@class = "control-label"})
                @Html.TextAreaFor(m => m.Description, new {@class = "form-control"})
            </div>
            <div class="form-group">
                <label class="control-label">Изображение</label>
                @if (Model.ImageData != null)
                {
                    <img id="image" style="width: 270px; height: 240px" src="@Url.Action("GetImage", "Content", new {productId = Model.ProductId})"/>
                }
                else
                {
                    <img id="image" style="width: 270px; height: 240px" src="@Url.Content("~/Content/img/no_image.jpg")"/>
                }
                <input id="input-image" name="NewImage" class="input-files" type="file"/>
            </div>
            <div class="panel-footer">
                <input type="submit" value="Сохранить" class="btn btn-success"/>
                @Html.ActionLink("Отменить", "ProductList", null, new {@class = "btn btn-default"})
            </div>
        }
    </div>
</div>

@section scripts
{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#input-image").bind({
                change: function() {
                    displayFiles(this.files[0]);
                }
            });

            function displayFiles(file) {

                if (!file.type.match(/image.*/)) {
                    return;
                }
                var img = $("#image");
                var reader = new FileReader();
                reader.onload = (function(aImg) {
                    return function(e) {
                        aImg.attr('src', e.target.result);
                    };
                })(img);
                reader.readAsDataURL(file);
            }
        });
    </script>
}
